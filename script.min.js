!function(){const _0=atob("aHR0cHM6Ly9vbWhmeGp2a2Zib3hvc2dja3hkay5zdXBhYmFzZS5jbw=="),_1=atob("ZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKemRYQmhZbUZ6WlNJc0luSmxaaUk2SW05dGFHWjRhblpyWm1KdmVHOXpaMk5yZUdScklpd2ljbTlzWlNJNkltRnViMjRpTENKcFlYUWlPakUzTlRrNE1qRXlOVFlzSW1WNGNDSTZNakEzTlRNNU56STFObjAuTGF2SE40bWtwNmg4eUtNak96TFV0emsxeXh5MzNGRUo4ZzZaOExweGVpbw=="),_2=window.supabase.createClient(_0,_1),_3=document,_4=_3.getElementById.bind(_3),_5=_3.querySelectorAll.bind(_3),_6=_4("authContainer"),_7=_4("mainContainer"),_8=_4("loginForm"),_9=_4("registerForm"),_a=_4("toggleAuthLink"),_b=_4("authToggleText"),_c=_4("authMsg"),_d=_4("userEmail"),_e=_4("btnSignOut"),_f=_4("todoForm"),_g=_4("taskList"),_h=_4("emptyState"),_i=_4("listTab"),_j=_4("formTab"),_k=_4("navList"),_l=_4("navForm"),_m=_5(".p-option"),_n=_4("priority"),_o=_4("regEmail"),_p=_4("regPassword"),_q=_4("specialCode"),_r=_4("email"),_s=_4("password"),_t=_4("title"),_u=_4("notes"),_v=_4("assigner");let _w=[],_x=null;const _y=e=>String(e).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;"),_z=()=>{if(_g.innerHTML="",!_w?.length)return void(_h.style.display="block");_h.style.display="none",_w.forEach(e=>{const t=_3.createElement("li");t.className=`task-item ${(e.priority||"Low").toLowerCase()} ${e.checked?"completed":""}`;const n=_y(e.title),o=_y(e.priority||"Low"),a=_y(e.assigner||"Anon"),r=e.notes?_y(e.notes).replace(/\n/g,"<br>"):"";t.innerHTML=`<div class="task-content"><div class="task-header"><p class="task-title">${n}</p><span class="task-badge">${o}</span></div>${r?`<div class="task-notes">${r}</div>`:""}<div class="task-footer"><div class="task-assigner">${a}</div><div class="task-actions"><button class="action-btn check ${e.checked?"checked":""}" data-id="${e.id}" title="Selesai"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg></button><button class="action-btn delete" data-id="${e.id}" title="Hapus"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg></button></div></div></div>`,_g.appendChild(t)}),_5(".action-btn.delete").forEach(e=>{e.addEventListener("click",function(){_G(Number(this.dataset.id))})}),_5(".action-btn.check").forEach(e=>{e.addEventListener("click",function(){const e=Number(this.dataset.id),t=_w.find(t=>t.id===e);t&&_H(e,!t.checked)})})},_A=()=>{_6.style.display="block",_7.style.display="none",_d.textContent="",_w=[],_z()},_B=e=>{_6.style.display="none",_7.style.display="block",_d.textContent=e.email||"",_F(),_J(0)},_C=()=>{const e=localStorage.getItem("yapp_user");if(e)try{const t=JSON.parse(e);return _x=t,_B(t),!0}catch(e){console.error(e),localStorage.removeItem("yapp_user")}return!1},_D=()=>{const e=_3.createElement("a");e.href="#",e.textContent="Lupa password?",e.style.cssText="display: block; margin-top: 10px; font-size: 13px; color: var(--accent); cursor: pointer;",e.addEventListener("click",async e=>{e.preventDefault();const t=prompt("Masukkan email Anda:");if(t)try{const{data:e,error:n}=await _2.from("users").select("password").eq("email",t).maybeSingle();if(n)throw n;e?alert(`Password Anda: ${e.password}`):alert("Email tidak ditemukan!")}catch(e){alert("Error: "+e.message)}}),_8.appendChild(e)},_E=async()=>{if("granted"!==Notification.permission){await Notification.requestPermission()}},_F=async()=>{try{const{data:e,error:t}=await _2.from("yapp_tasks").select("*").eq("shared_id","shared").order("created_at",{ascending:!1});if(t)throw t;_w=e||[],_z()}catch(e){alert("Error: "+e.message)}},_G=async e=>{if(confirm("Hapus?"))try{const{error:t}=await _2.from("yapp_tasks").delete().eq("id",e);if(t)throw t;_w=_w.filter(t=>t.id!==e),_z()}catch(e){alert("Error: "+e.message)}},_H=async(e,t)=>{try{const{error:n}=await _2.from("yapp_tasks").update({checked:t}).eq("id",e);if(n)throw n;const o=_w.find(t=>t.id===e);o&&(o.checked=t),_z()}catch(e){console.error(e)}},_I=()=>{_2.channel("yapp_realtime").on("postgres_changes",{event:"INSERT",schema:"public",table:"yapp_tasks"},e=>{navigator.serviceWorker?.controller&&navigator.serviceWorker.controller.postMessage({type:"NEW_TASK",payload:e.new})}).subscribe()},_J=e=>{_i.classList.remove("active"),_j.classList.remove("active"),_k.classList.remove("nav-active"),_l.classList.remove("nav-active"),0===e?(_i.classList.add("active"),_k.classList.add("nav-active")):(_j.classList.add("active"),_l.classList.add("nav-active"))};_a.addEventListener("click",e=>{e.preventDefault();const t="none"!==_8.style.display&&!_8.classList.contains("hidden");t?(_8.classList.add("hidden"),_9.classList.remove("hidden"),_b.textContent="Sudah punya akun?",_a.textContent="Login"):(_9.classList.add("hidden"),_8.classList.remove("hidden"),_b.textContent="Belum punya akun?",_a.textContent="Daftar")}),_9.addEventListener("submit",async e=>{e.preventDefault(),_c.textContent="",_c.style.color="";const t=_o.value,n=_p.value;if(n.length<6)return _c.textContent="Min 6 karakter!",void(_c.style.color="#ff6b6b");const o=_q.value.trim();if(atob("Y3V0aWVzZndyMjg=") !== o)return _c.textContent="Kode salah!",void(_c.style.color="#ff6b6b");try{const{data:e,error:o}=await _2.from("users").select("email").eq("email",t).maybeSingle();if(e)return _c.textContent="Email terdaftar!",void(_c.style.color="#ff6b6b");const{data:a,error:r}=await _2.from("users").insert([{email:t,password:n}]).select().single();if(r)throw r;_x=a,localStorage.setItem("yapp_user",JSON.stringify(a)),_c.textContent="Berhasil!",_c.style.color="#34d399",setTimeout(()=>{_B(_x)},1e3)}catch(e){_c.textContent="Error: "+e.message,_c.style.color="#ff6b6b"}}),_8.addEventListener("submit",async e=>{e.preventDefault(),_c.textContent="",_c.style.color="";const t=_r.value,n=_s.value;try{const{data:o,error:a}=await _2.from("users").select("*").eq("email",t).eq("password",n).maybeSingle();if(!o)throw new Error("Login gagal!");_x=o,localStorage.setItem("yapp_user",JSON.stringify(o)),_c.textContent="Berhasil!",_c.style.color="#34d399",_B(_x)}catch(e){_c.textContent=e.message,_c.style.color="#ff6b6b"}}),_e.addEventListener("click",()=>{_x=null,localStorage.removeItem("yapp_user"),_A()}),_m.forEach(e=>{e.addEventListener("click",()=>{_m.forEach(e=>e.classList.remove("selected")),e.classList.add("selected"),_n.value=e.dataset.value})}),_k.addEventListener("click",()=>_J(0)),_l.addEventListener("click",()=>_J(1)),_f.addEventListener("submit",async e=>{e.preventDefault();if(!_x)return alert("Login dulu!");const t=_t.value.trim(),n=_n.value,o=_u.value.trim(),a=_v.value.trim();if(!t||!a)return alert("Isi data!");try{const{data:e,error:r}=await _2.from("yapp_tasks").insert([{title:t,notes:o,priority:n,assigner:a,shared_id:"shared",checked:!1,user_id:_x.id}]).select();if(r)throw r;e?.[0]&&_w.unshift(e[0]),_z(),_f.reset(),_m.forEach(e=>e.classList.remove("selected")),_3.querySelector('.p-option[data-value="Low"]').classList.add("selected"),_n.value="Low",_J(0)}catch(e){alert("Error: "+e.message)}}),_J(0),_3.addEventListener("DOMContentLoaded",_D),!function(){_C()||_A()}(),_x&&(_E(),_I())}();
